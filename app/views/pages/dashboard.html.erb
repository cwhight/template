<% page = "profile" %>
<% pending_requests = 0 %>
<% current_user.requests.each do |request| %>
  <% unless request.shift.user || Time.parse(request.shift.start_time) < Time.now %>
    <% pending_requests += 1 %>
  <% end %>
<% end %>
<% upcoming_jobs = current_user.shifts.where({completed: nil}) %>

<% unread_messages = 0 %>
<% chats = current_user.employee_chats %>
<% chats.each do |chat| %>
  <% unread_messages += chat.messages.select {|m| m.user != current_user && !m.read }.size %>
<% end %>

<div class="wrapper">
 <%= render 'pages/shared/employee_dashboard_sidebar', page: page %>

  <div class="container" id="content">

    <div class="selector py-3">
          <!-- MOBILE TOP ROW - USER PROFILE -->
        <div class="m-3 d-md-none">
          <div id="profile-card" class="soft-card shadow-sm row align-items-center justify-content-around ">
            <%= render 'users/shared/profile-card', user: current_user %>
          </div>
        </div>

    <!-- FULL SCREEN TOP ROW _ USER PROFILE INFO -->
        <div class="d-none d-md-block m-3">
          <%= render 'users/shared/full-screen-employee-profile' %>
        </div>

      <!-- SECOND ROW ICON LINKS -->
        <div class="row my-3 justify-content-between">
        <!-- LEFT HAND SIDE -->
          <div class="col-12 col-lg-6 mx-0 p-0">

            <div class="text-center p-0 d-flex flex-column">
          <!-- TOP ROW -->
              <div class="soft-card shadow-sm my-1 mx-3">
                <div class="btn p-3 m-2">
                  <a href="/inbox" ><img src="https://img.icons8.com/nolan/96/inbox.png"/></a>
                  <p class="dash-btn">Inbox ( <%= unread_messages %> )</p>
                </div>
              </div>
          <!-- BOTTOM ROW -->
              <div class="soft-card shadow-sm my-1 mx-3">
                <div class="btn dash-btn p-3 m-2">
                  <a href="/dashboard/favourites" ><img src="https://img.icons8.com/nolan/96/half-heart.png"/></a>
                    <p class="dash-btn">Favourites ( <%= current_user.favourites.count %> )</p>
                </div>
              </div>
            </div>
          </div>
      <!-- RIGHT HAND SIDE -->
          <div class="mx-0 p-0 col-12 col-lg-6"  >
        <!-- TOP ROW -->
            <div class="d-flex flex-column p-0 text-center">
              <div class="soft-card shadow-sm my-1 mx-3">
                <div class="">
                  <div class="btn dash-btn p-3 m-2" >
                    <a href="/dashboard/pending" ><img src="https://img.icons8.com/nolan/96/questions.png"/></a>
                      <p class="dash-btn">Applications ( <%= pending_requests %> )</p>
                  </div>
                </div>

              </div>
          <!-- BOTTOM ROW -->
              <div class="d-flex justify-content-around">
                <div class="text-center w-50">
                  <div class="shadow-sm soft-card my-1 ml-3 mr-1">
                    <div class="btn dash-btn p-3 m-2">
                      <a href="/dashboard/upcoming" ><img src="https://img.icons8.com/nolan/96/planner.png"/></a>
                        <p class="dash-btn">Upcoming ( <%= upcoming_jobs.count %> )</p>
                    </div>
                  </div>
                </div>
                <div class="text-center w-50">
                  <div class="shadow-sm soft-card my-1 mr-3 ml-1">
                    <div class="btn dash-btn p-3 m-2">
                      <a href="/dashboard/historic" ><img src="https://img.icons8.com/nolan/96/expired.png"/></a>
                        <p class="dash-btn">Job History</p>
                    </div>
                  </div>
                </div>
              </div>

            </div>
          </div>
        </div>
      </div>
        <div class="row">
          <div class="col-12">

            <div
              data-upcoming="<%= User.upcoming_shifts_to_json(current_user.id).to_json %>"
              data-past="<%= User.past_shifts_to_json(current_user.id).to_json %>"
              data-pending="<%= User.pending_shifts_to_json(current_user.id).to_json %>"
              id="calendar" class="p-3 m-2">
            </div>
          </div>

        </div>

    </div>
  </div>

</div>


